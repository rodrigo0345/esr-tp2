<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MJPEG Stream Player</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        canvas {
            max-width: 100%;
            border: 2px solid #333;
        }
    </style>
</head>
<body>

<h1>MJPEG Stream Player</h1>
<canvas id="videoCanvas"></canvas>

<script defer>

    const videoCanvas = document.getElementById('videoCanvas');
    // read rtp connection
    
    const socket = new WebSocket('ws://localhost:5004/stream');

    socket.onopen = function() {
        console.log('WebSocket connection opened.');
    };

    socket.onmessage = async function(event) {
        const data = event.data;
        console.log('Received data:', data);

        // Decode the binary data into a Uint8Array
        const binaryData = new Uint8Array(data);

        // Create a new ImageData object with the binary data
        const imageData = new ImageData(binaryData, width, height);

        // Create a new ImageBitmap from the ImageData
        const imageBitmap = await createImageBitmap(imageData);

        // Create a new CanvasImageSource from the ImageBitmap
        const canvasImageSource = await createImageBitmap(imageBitmap);

        // Draw the CanvasImageSource onto the canvas
        videoCanvas.getContext('2d').drawImage(canvasImageSource, 0, 0);
    };

    socket.onclose = function() {
        console.log('WebSocket connection closed.');
    };
</script>

</body>
</html>
